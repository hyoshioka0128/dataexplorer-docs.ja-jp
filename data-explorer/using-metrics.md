---
title: メトリックを使用した Azure Data Explorer のパフォーマンス、正常性、および使用状況の監視
description: Azure Data Explorer メトリックを使用して、クラスターのパフォーマンス、正常性、および使用状況を監視する方法について説明します。
author: orspod
ms.author: orspodek
ms.reviewer: gabil
ms.service: data-explorer
ms.topic: conceptual
ms.date: 01/19/2020
ms.openlocfilehash: ffe641c6e96db1378be7a8ce845685fb2b66715f
ms.sourcegitcommit: bb8c61dea193fbbf9ffe37dd200fa36e428aff8c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/13/2020
ms.locfileid: "83374309"
---
# <a name="monitor-azure-data-explorer-performance-health-and-usage-with-metrics"></a>メトリックを使用した Azure Data Explorer のパフォーマンス、正常性、および使用状況の監視

Azure Data Explorer は、アプリケーション、Web サイト、IoT デバイスなどからの大量のデータ ストリーミングをリアルタイムに分析するためのフル マネージドのデータ分析サービスです。 Azure Data Explorer を使用するには、最初にクラスターを作成し、そのクラスター内に 1 つまたは複数のデータベースを作成します。 その後、クエリを実行できるように、データをデータベースに取り込み (読み込み) ます。 Azure Data Explorer メトリックは、クラスター リソースの正常性とパフォーマンスに関する主要な指標を提供します。 この記事で詳細に説明するメトリックを使用して、特定のシナリオでの Azure Data Explorer クラスターの正常性とパフォーマンスをスタンドアロン メトリックとして監視します。 また、[Azure ダッシュボード](/azure/azure-portal/azure-portal-dashboards) と [Azure アラート](/azure/azure-monitor/platform/alerts-metric-overview) の操作の基本としてメトリックを使用できます。

## <a name="prerequisites"></a>前提条件

* Azure サブスクリプション。 お持ちでない場合は、[無料の Azure アカウント](https://azure.microsoft.com/free/)を作成することができます。
* [クラスターとデータベース](create-cluster-database-portal.md)。

## <a name="using-metrics"></a>メトリックの使用

1. [Azure portal](https://portal.azure.com/) にサインインします。
1. Azure Data Explorer クラスターで、 **[メトリック]** を選択して [メトリック] ウィンドウを開き、クラスターの分析を開始します。
    ![[メトリック] を選択する](media/using-metrics/select-metrics.png)。
1. [メトリック] ウィンドウでの操作:![[メトリック] ウィンドウ](media/using-metrics/metrics-pane.png)
    1. メトリック グラフを作成するには、**メトリック**名と、メトリックあたりの適切な**集計**を選択します。 Azure Data Explorer クラスターの **[リソース]** と **[メトリック名前空間]** は事前に選択されています。 さまざまなメトリックの詳細については、「[サポートされている Azure Data Explorer メトリック](#supported-azure-data-explorer-metrics)」を参照してください。
    1. 同じグラフにプロットされた複数のメトリックを表示する場合は、 **[メトリックの追加]** を選択します。
    1. 1 つのビューに複数のグラフを表示する場合は、 **[+ New chart]\(+ 新規グラフ\)** を選択します。
    1. 時間範囲を変更する場合は、時刻の選択ツールを使用します (既定: 過去 24 時間)。
    1. ディメンションを持つメトリックには、[ **[フィルターの追加]** および **[Apply Splitting]\(分割の適用\)** ](/azure/azure-monitor/platform/metrics-getting-started#apply-dimension-filters-and-splitting) を使用します。
    1. グラフ構成をダッシュボードに追加して、再度表示できるようにする場合は、 **[ダッシュボードにピン留めする]** を選択します。
    1. 設定した条件を使用してメトリックを視覚化するには、 **[新しいアラート ルール]** を設定します。 新しいアラート ルールにはターゲット リソース、メトリック、分割、およびグラフからのフィルター ディメンションが含まれます。 これらの設定は、[アラート ルールの作成ウィンドウ](/azure/azure-monitor/platform/metrics-charts#create-alert-rules)で変更します。

[メトリックス エクスプローラー](/azure/azure-monitor/platform/metrics-getting-started)の使用に関する追加情報。

## <a name="supported-azure-data-explorer-metrics"></a>サポートされている Azure Data Explorer メトリック

サポートされている Azure Data Explorer メトリックは、使用状況に応じてさまざまなカテゴリに分けられます。 

### <a name="cluster-health-metrics"></a>クラスターの正常性メトリック

クラスターの正常性メトリックは、クラスターの全般的な正常性を追跡します。 これには、リソースおよびインジェストの使用率と応答性が含まれます。

**メトリック** | **単位** | **集計** | **メトリックの説明** | **Dimensions** |
|---|---|---|---|---|
| キャッシュ使用率 | Percent | Avg、Max、Min | クラスターで現在使用中の割り当てられたキャッシュ リソースの割合。 キャッシュとは、定義されているキャッシュ ポリシーに従ってユーザー アクティビティに割り当てられた SSD のサイズのことです。 80% 以下の平均キャッシュ使用率が、クラスターにとって持続可能な状態です。 平均キャッシュ使用率が 80% を超える場合、ストレージ最適化価格レベルにクラスターを[スケールアップ](manage-cluster-vertical-scaling.md)するか、より多くのインスタンスを[スケールアウト](manage-cluster-horizontal-scaling.md)します。 あるいは、キャッシュ ポリシーを調整します (キャッシュに格納する日数を削減)。 キャッシュ使用率が 100% を超える場合、キャッシュ ポリシーに基づいてキャッシュされるデータのサイズが、クラスター上の合計キャッシュ サイズを超えています。 | なし |
| CPU | Percent | Avg、Max、Min | クラスター内のマシンで現在使用中の割り当てられたコンピューティング リソースの割合。 80% 以下の平均 CPU 使用率が、クラスターにとって持続可能です。 CPU の最大値は 100% であり、これは、データを処理する計算リソースがそれ以上ないことを示します。 クラスターのパフォーマンスが良くない場合は、特定の CPU がブロックされていないか判別するために、CPU の最大値を確認してください。 | なし |
| インジェストの使用率 | Percent | Avg、Max、Min | 割り当てられた合計リソースからのデータのインジェストに使用された実際のリソースと、インジェストを実行するために容量ポリシーに割り当てられた合計リソースの間の比率。 既定の容量ポリシーでは、同時実行のインジェスト操作は 512 以下、またはインジェストに使用されるクラスター リソースは 75% 以下です。 80% 以下の平均インジェスト使用率が、クラスターにとって持続可能な状態です。 インジェスト使用率の最大値は 100% であり、これは、すべてのクラスター インジェスト機能が使用され、インジェストがキューに入れられる結果となる可能性を示します。 | なし |
| キープ アライブ | Count | Avg | クラスターの応答性を追跡します。 応答性の高いクラスターは 1 の値を返し、ブロックまたは切断されたクラスターは 0 を返します。 |
| スロットルされたコマンドの合計数 | Count | Avg、Max、Min、Sum | 同時 (並列) コマンドの最大許容数に達したために、クラスター内でスロットルされた (拒否された) コマンドの数。 | なし |
| エクステントの合計数 | Count | Avg、Max、Min、Sum | クラスター内のデータ エクステントの合計数。 データ エクステントのマージは CPU 負荷が高いアクティビティであるため、このメトリックの変化は、データ構造の大幅な変更とクラスターでの高負荷を示している可能性があります。 | なし |
| | | | |

### <a name="export-health-and-performance-metrics"></a>エクスポートの正常性とパフォーマンス メトリック

エクスポートの正常性とパフォーマンス メトリックは、エクスポート操作の全般的な正常性とパフォーマンス (遅延、結果、レコード数、使用状況など) を追跡します。

**メトリック** | **単位** | **集計** | **メトリックの説明** | **Dimensions** |
|---|---|---|---|---|
連続エクスポートによるエクスポートされたレコード数    | Count | SUM | すべての連続エクスポート ジョブでエクスポートされたレコードの数。 | なし |
連続エクスポートの最大遅延 |    Count   | Max   | クラスター内の連続エクスポート ジョブによって報告された遅延 (分単位)。 | なし |
保留中の連続エクスポートの数 | Count | Max   | 保留中の連続エクスポート ジョブの数。 これらのジョブは実行する準備ができていますが、キューで待機中になっています。これは、容量不足が原因である可能性があります。 
連続エクスポートの結果    | Count |   Count   | 各連続エクスポート実行の失敗および成功の結果。 | ContinuousExportName |
エクスポート使用率 |    Percent | Max   | クラスター内のエクスポート容量の合計のうち、使用されているエクスポート容量 (0 から 100 の間)。 | なし |
| | | | |

### <a name="ingestion-health-and-performance-metrics"></a>インジェストの正常性とパフォーマンス メトリック

インジェストの正常性とパフォーマンス メトリックは、インジェスト操作の全般的な正常性とパフォーマンス (遅延、結果、量など) を追跡します。

**メトリック** | **単位** | **集計** | **メトリックの説明** | **Dimensions** |
|---|---|---|---|---|
| (Event/IoT Hubs の) 処理されたイベント | Count | Max、Min、Sum | イベント ハブから読み取られ、クラスターによって処理されたイベントの数。 イベントは、クラスター エンジンによって拒否されたイベントと受け入れられたイベントに分類されます。 | EventStatus |
| インジェストの待ち時間 | Seconds | Avg、Max、Min | クラスターでデータが受信された時点からクエリー用に準備できるまでの、取り込まれたデータの待ち時間。 インジェストの待ち時間の長さは、インジェストのシナリオに応じて異なります。 | なし |
| インジェストの結果 | Count | Count | 失敗および成功したインジェスト操作の合計数。 **[Apply Splitting]\(分割の適用\)** を使用して、成功および失敗した結果のバケットを作成し、ディメンションを分析します ( **[値]**  >  **[状態]** )。| IngestionResultDetails |
| インジェストの量 (MB 単位) | Count | Max、Sum | 圧縮前にクラスターにインジェストされたデータの合計サイズ (MB 単位)。 | データベース |
| | | | |  

### <a name="query-performance"></a>クエリ パフォーマンス

クエリ パフォーマンス メトリックは、クエリ期間および同時クエリまたはスロットルされたクエリの合計数を追跡します。

**メトリック** | **単位** | **集計** | **メトリックの説明** | **Dimensions** |
|---|---|---|---|---|
| クエリ実行時間 | ミリ秒 | Avg、Min、Max、Sum | クエリ結果を受け取るまでの合計時間 (ネットワーク待ち時間は含まれません)。 | QueryStatus |
| 同時クエリの合計数 | Count | Avg、Max、Min、Sum | クラスターで並列実行されるクエリの数。 このメトリックは、クラスターの負荷を見積もるのに適した方法です。 | なし |
| スロットルされたクエリの合計数 | Count | Avg、Max、Min、Sum | クラスター内のスロットルされた (拒否された) クエリの数。 許可される同時 (並列) クエリの最大数は、同時クエリ ポリシーで定義されます。 | なし |
| | | | |

### <a name="streaming-ingest-metrics"></a>ストリーミング インジェスト メトリック

ストリーミング インジェスト メトリックは、ストリーミング インジェスト データおよび要求率、期間、結果を追跡します。

**メトリック** | **単位** | **集計** | **メトリックの説明** | **Dimensions** |
|---|---|---|---|---|
ストリーミング インジェストのデータ速度 |    Count   | RateRequestsPerSecond | クラスターに取り込まれるデータの総量。 | なし |
ストリーミング インジェストの期間   | ミリ秒  | Avg、Max、Min | すべてのストリーミング インジェスト要求の合計期間。 | なし |
ストリーミング インジェストの要求率   | Count | Count、Avg、Max、Min、Sum | ストリーミングインジェスト要求の合計数。 | なし |
ストリーミング インジェストの結果 | Count | Avg   | 結果の種類別のストリーミング インジェスト要求の合計数。 | 結果 |
| | | | |

[サポートされる Azure Data Explorer クラスター メトリック](/azure/azure-monitor/platform/metrics-supported#microsoftkustoclusters)に関する追加情報。


## <a name="next-steps"></a>次のステップ

* [チュートリアル:Azure Data Explorer で監視データを取り込んでクエリを実行する](ingest-data-no-code.md)
* [診断ログを使用して Azure Data Explorer インジェスト操作を監視する](using-diagnostic-logs.md)
* [クイック スタート: Azure Data Explorer でデータのクエリを実行する](web-query-data.md)
