---
title: funnel_sequenceプラグイン - Azure データ エクスプローラー |マイクロソフトドキュメント
description: この記事では、Azure データ エクスプローラーfunnel_sequenceプラグインについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/13/2020
ms.openlocfilehash: a0543d0083fd90d5ee3e6e94cf1ee203f6cbd50d
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/15/2020
ms.locfileid: "81514741"
---
# <a name="funnel_sequence-plugin"></a>funnel_sequence プラグイン

一連の状態を取得したユーザーの個別の数を計算し、その後に/に至った前/次の状態の分布を計算します。 

```kusto
T | evaluate funnel_sequence(id, datetime_column, startofday(ago(30d)), startofday(now()), 10m, 1d, state_column, dynamic(['S1', 'S2', 'S3']))
```

**構文**

*T* `| evaluate` `,` *Start* `,` *End* *IdColumn* `,` *TimelineColumn* `,` *Sequence* *Step* *StateColumn* *MaxSequenceStepWindow*IdColumn タイムライン列開始エンド MaxSequenceStepWindow , ステップ , 状態列 , シーケンス`funnel_sequence(``)`

**引数**

* *T*: 入力表形式の式。
* *IdColum*: 列参照は、ソース式に存在する必要があります。
* *タイムライン列*: タイムラインを表す列参照は、ソース式に存在する必要があります。
* *開始*: 分析開始期間のスカラー定数値
* *終了*: 分析終了期間のスカラー定数値
* *MaxSequenceStepWindow*: シーケンス内の 2 つの連続したステップ間の最大許容タイムスパンのスカラー定数値
* *ステップ*: 分析ステップ周期のスカラー定数値 (bin)
* *状態列*: 状態を表す列参照は、ソース式に存在する必要があります。
* *シーケンス*: シーケンス値を持つ定数動的配列 (値は`StateColumn`で検索されます)

**戻り値**

分析されたシーケンスのサンキーダイアグラムを構築するのに役立つ3つの出力テーブルを返します。

* テーブル #1 - 前のシーケンス次の dcount TimelineColumn: 分析されたタイム ウィンドウの前: 前の状態 (検索されたシーケンスのイベントのみがあり、それ以前のイベントがないユーザーがいる場合は空になる可能性があります)。 
    次の状態: 次の状態 (検索されたシーケンスのイベントのみがあり、その後に続くイベントがないユーザーがいる場合は空になる可能性があります)。 
    dcount: [prev] --> <IdColumn> <Sequence> --> [next] を遷移した時間枠内の個別のカウント。 
    samples: 行のシーケンスに対応する<IdColumn>ID の配列 (from ) (最大 128 個の ID が返されます)。 

* テーブル#2 - 前のシーケンス dcount TimelineColumn: 分析された時間枠の前: 前の状態 (検索されたシーケンスのイベントのみがあり、それ以前のイベントがないユーザーがいる場合は空である可能性があります)。 
    dcount: [prev] --> <IdColumn> <Sequence> --> [next] を遷移した時間枠内の個別のカウント。 
    samples: 行のシーケンスに対応する<IdColumn>ID の配列 (from ) (最大 128 個の ID が返されます)。 

* テーブル #3 - シーケンス次 dcount TimelineColumn: 次に分析されたタイム ウィンドウ: 次の状態 (検索されたシーケンスのイベントのみがあり、その後に続くイベントがないユーザーがいる場合は空になる可能性があります)。 
    dcount: [prev] --> <IdColumn> <Sequence> --> [next] を遷移した時間枠内の個別のカウント。 
    samples: 行のシーケンスに対応する<IdColumn>ID の配列 (from ) (最大 128 個の ID が返されます)。 


**使用例**

### <a name="exploring-storm-events"></a>嵐のイベントを探る 

次のクエリは、StormEvents (2007 の天気予報) テーブルを調べ、2007 年に発生したすべての竜巻イベントの前後に発生したイベントを示します。

```kusto
// Looking on StormEvents statistics: 
// Q1: What happens before Tornado event?
// Q2: What happens after Tornado event?
StormEvents
| evaluate funnel_sequence(EpisodeId, StartTime, datetime(2007-01-01), datetime(2008-01-01), 1d,365d, EventType, dynamic(['Tornado']))
```

結果には、次の 3 つのテーブルが含まれます。

* テーブル#1: シーケンスの前後に起こったすべての可能なバリアント。 たとえば、2 行目は、次のシーケンスを持つ 87 の異なるイベントがあったことを示します。`Hail` -> `Tornado` -> `Hail`


|StartTime|prev|[次へ]|dcount|
|---|---|---|---|
|2007-01-01 00:00:00.0000000|||293|
|2007-01-01 00:00:00.0000000|ひょう|ひょう|87|
|2007-01-01 00:00:00.0000000|雷雨風|雷雨風|77|
|2007-01-01 00:00:00.0000000|ひょう|雷雨風|28|
|2007-01-01 00:00:00.0000000|ひょう||28|
|2007-01-01 00:00:00.0000000||ひょう|27|
|2007-01-01 00:00:00.0000000||雷雨風|25|
|2007-01-01 00:00:00.0000000|雷雨風|ひょう|24|
|2007-01-01 00:00:00.0000000|雷雨風||24|
|2007-01-01 00:00:00.0000000|鉄砲水|鉄砲水|12|
|2007-01-01 00:00:00.0000000|雷雨風|鉄砲水|8|
|2007-01-01 00:00:00.0000000|鉄砲水||8|
|2007-01-01 00:00:00.0000000|漏斗雲|雷雨風|6|
|2007-01-01 00:00:00.0000000||漏斗雲|6|
|2007-01-01 00:00:00.0000000||鉄砲水|6|
|2007-01-01 00:00:00.0000000|漏斗雲|漏斗雲|6|
|2007-01-01 00:00:00.0000000|ひょう|鉄砲水|4|
|2007-01-01 00:00:00.0000000|鉄砲水|雷雨風|4|
|2007-01-01 00:00:00.0000000|ひょう|漏斗雲|4|
|2007-01-01 00:00:00.0000000|漏斗雲|ひょう|4|
|2007-01-01 00:00:00.0000000|漏斗雲||4|
|2007-01-01 00:00:00.0000000|雷雨風|漏斗雲|3|
|2007-01-01 00:00:00.0000000|大雨|雷雨風|2|
|2007-01-01 00:00:00.0000000|鉄砲水|漏斗雲|2|
|2007-01-01 00:00:00.0000000|鉄砲水|ひょう|2|
|2007-01-01 00:00:00.0000000|強風|雷雨風|1|
|2007-01-01 00:00:00.0000000|大雨|鉄砲水|1|
|2007-01-01 00:00:00.0000000|大雨|ひょう|1|
|2007-01-01 00:00:00.0000000|ひょう|洪水|1|
|2007-01-01 00:00:00.0000000|雷|ひょう|1|
|2007-01-01 00:00:00.0000000|大雨|雷|1|
|2007-01-01 00:00:00.0000000|漏斗雲|大雨|1|
|2007-01-01 00:00:00.0000000|鉄砲水|洪水|1|
|2007-01-01 00:00:00.0000000|洪水|鉄砲水|1|
|2007-01-01 00:00:00.0000000||大雨|1|
|2007-01-01 00:00:00.0000000|漏斗雲|雷|1|
|2007-01-01 00:00:00.0000000|雷|雷雨風|1|
|2007-01-01 00:00:00.0000000|洪水|雷雨風|1|
|2007-01-01 00:00:00.0000000|ひょう|雷|1|
|2007-01-01 00:00:00.0000000||雷|1|
|2007-01-01 00:00:00.0000000|熱帯暴風雨|ハリケーン(台風)|1|
|2007-01-01 00:00:00.0000000|沿岸洪水||1|
|2007-01-01 00:00:00.0000000|リップ電流||1|
|2007-01-01 00:00:00.0000000|大雪||1|
|2007-01-01 00:00:00.0000000|強風||1|

* 表#2: 前のイベントごとにグループ化されたすべての個別のイベントを表示します。 たとえば、2 行目は、直前に発生したイベントの`Hail`合計 150 件があったことを示しています。`Tornado`

|StartTime|prev|Dカウント|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||331|
|2007-01-01 00:00:00.0000000|ひょう|150|
|2007-01-01 00:00:00.0000000|雷雨風|135|
|2007-01-01 00:00:00.0000000|鉄砲水|28|
|2007-01-01 00:00:00.0000000|漏斗雲|22|
|2007-01-01 00:00:00.0000000|大雨|5|
|2007-01-01 00:00:00.0000000|洪水|2|
|2007-01-01 00:00:00.0000000|雷|2|
|2007-01-01 00:00:00.0000000|強風|2|
|2007-01-01 00:00:00.0000000|大雪|1|
|2007-01-01 00:00:00.0000000|リップ電流|1|
|2007-01-01 00:00:00.0000000|沿岸洪水|1|
|2007-01-01 00:00:00.0000000|熱帯暴風雨|1|

* 表#3: 次のイベントごとにグループ化されたすべての個別のイベントを表示します。 たとえば、2 行目は、その後に発生したイベントの`Hail`合計 143 件があったことを示しています。`Tornado`

|StartTime|[次へ]|Dカウント|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||332|
|2007-01-01 00:00:00.0000000|ひょう|145|
|2007-01-01 00:00:00.0000000|雷雨風|143|
|2007-01-01 00:00:00.0000000|鉄砲水|32|
|2007-01-01 00:00:00.0000000|漏斗雲|21|
|2007-01-01 00:00:00.0000000|雷|4|
|2007-01-01 00:00:00.0000000|大雨|2|
|2007-01-01 00:00:00.0000000|洪水|2|
|2007-01-01 00:00:00.0000000|ハリケーン(台風)|1|

次に、次のシーケンスがどのように続くのかを見てみましょう。  
`Hail` -> `Tornado` -> `Thunderstorm Wind`

```kusto
StormEvents
| evaluate funnel_sequence(EpisodeId, StartTime, datetime(2007-01-01), datetime(2008-01-01), 1d,365d, EventType, 
dynamic(['Hail', 'Tornado', 'Thunderstorm Wind']))
```

スキップ`Table #1`して`Table #2`、見て`Table #3`- 92のイベントのシーケンス`Hail` -> `Tornado` -> `Thunderstorm Wind`は、このシーケンスで終わり、41の`Hail`イベントのように続け、14`Tornado`に戻ったと結論付けることができます。

|StartTime|[次へ]|Dカウント|
|---------|-----|------|
|2007-01-01 00:00:00.0000000||92|
|2007-01-01 00:00:00.0000000|ひょう|41|
|2007-01-01 00:00:00.0000000|竜巻|14|
|2007-01-01 00:00:00.0000000|鉄砲水|11|
|2007-01-01 00:00:00.0000000|雷|2|
|2007-01-01 00:00:00.0000000|大雨|1|
|2007-01-01 00:00:00.0000000|洪水|1|