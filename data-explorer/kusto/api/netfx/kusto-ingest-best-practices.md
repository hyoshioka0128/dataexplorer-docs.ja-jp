---
title: Kusto INGEST クライアント ライブラリ - ベスト プラクティス - Azure データ エクスプローラー |マイクロソフトドキュメント
description: この記事では、Azure データ エクスプローラーでの Kusto INGEST クライアント ライブラリのベスト プラクティスについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 08/16/2019
ms.openlocfilehash: e28ec3f99abe4163b83721d753da98c0035d1e46
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/15/2020
ms.locfileid: "81523700"
---
# <a name="kusto-ingest-client-library---best-practices"></a>Kusto INGEST クライアント ライブラリ - ベスト プラクティス

## <a name="choosing-the-right-ingestclient-flavor"></a>適切なインジェストクライアントフレーバーの選択
推奨されるネイティブ データ インジェスト モードは[、KustoQueuedIngest クライアント](kusto-ingest-client-reference.md#interface-ikustoqueuedingestclient)を使用します。 理由は次のとおりです。
* Kusto Engine のダウンタイム (デプロイ中など) には直接インジェストは不可能ですが、キューインジェスト モードでは要求は Azure キューに保持され、データ管理サービスは必要に応じて再試行されます。
* データ管理サービスは、取り込み要求でエンジンを過負荷にしないようにします。 このコントロールをオーバーライドする (たとえば、直接取り込みを使用する) エンジンのパフォーマンスに重大な影響を与える可能性があります(インジェクションとクエリの両方)。
* データ管理は、作成される初期シャード (エクステント) のサイズを最適化するために、複数のインジェスト要求を集約します。
* 成功したかどうかに関係なく、各インジェストに関するフィードバックを得るための便利な方法があります。

## <a name="tracking-ingest-operation-status"></a>インジェスト操作の状態の追跡
[Ingest 操作の状態を追跡](kusto-ingest-client-status.md#tracking-ingestion-status-kustoqueuedingestclient)することは Kusto の便利な機能ですが、成功レポートに対してオンにすると、サービスが損なわれる程度に悪用される可能性があります。<BR>

> [!WARNING]
> 大量のデータ ストリームに対するインジェスト要求ごとに肯定通知を有効にする必要があります。これは、基になる xStore リソースに極端な負荷がかかるため、>、インジェストの待機時間が長くなり、クラスターの応答性が完全になる可能性があるためです。

## <a name="optimizing-for-throughput"></a>スループットの最適化
* インジェストは、大きなチャンクで実行した場合、最適な機能を発揮します (つまり、取り込み中に最小のリソースを消費し、COGS 最適化されたデータ シャードを最も多く生成し、最もパフォーマンスの高いデータ 成果物を生成します)。 一般的に、Kusto.Ingest ライブラリまたはエンジンに直接データを取り込むお客様は **、100 MB ~ 1 GB (非圧縮)** のバッチでデータを送信することをお勧めします。
* この上限は、Kusto エンジンと直接作業して、インジェスト プロセスで使用されるメモリ量を減らすときに重要です`KustoQueuedIngestClient`(クラスを使用する場合、クライアント上で過度に大きなデータ ブロックがクライアント上で小さな部分に分割され、小さなチャンクが特定の程度に集約されてから、Kusto Engine に到達する前に、一定の量だけ集計されます)。
* 取り込んだデータ サイズの下限も重要ですが、重要度は低くなります。 小さなバッチでデータを取り込むと、大きなバッチを使用するよりも少し効率が悪いが、今、そしてその後完全に問題ありません。 `KustoQueuedIngestClient`クラスはまた、大量のデータを取り込む必要があり、Kustoに送信する前に大きなチャンクにそれらをバッチ処理することができない顧客のための問題を解決します

## <a name="factors-impacting-ingestion-throughput"></a>取り込みスループットに影響を与える要因
複数の要因が取り込みスループットに影響を与える可能性があります。 Kusto インジェスト パイプラインを計画する際には、以下の点を評価してください。
* データ形式 - CSVは取り込むのに最も高速な形式で、JSONは通常、同じ量のデータに対してx2またはx3の時間がかかります
* テーブルの幅 - テーブルが広いほど、より多くの列がエンコードおよびインデックス化されるため、スループットが低下するため、実際に必要なデータのみを取り込みます。
    取り込みマッピングを提供することで、取り込まれるフィールドを制御できます。
* ソース データの場所 - クロス リージョンの読み取りを回避すると、インジェスが高速化されます。
* クラスターへの負荷 - クラスターで高いクエリ負荷が発生すると、取り込みが完了するまでに時間がかかり、スループットが低下します。
* インジェストパターン - クラスターが最大 1 GB のバッチで提供される場合 (使用`KustoQueuedIngestClient`して注意して) インジェストが最適です。

## <a name="optimizing-for-cogs"></a>COGS の最適化
Kusto クライアント ライブラリを使用して、データを Kusto に取り込む際に最も安価で堅牢なオプションを維持しながら、お客様には、インジェストの手法を確認し、Blob トランザクションを大幅に (x100) コストを高くした Azure Storage の最近の変更 (2017 年秋) を考慮に入れるようお勧めします。
<BR>
Kustoに送信するデータ(ファイル/BLOB/ストリーム)のチャンクが多ければ多いほど、毎月の請求書が大きくなることを理解することが重要です。
以下の推奨事項に従えば、Kusto の摂取コストをより適切に管理できます。
* **より大きなデータのチャンクを取り込むことを好む(最大1GBの非圧縮データ)**<br>
    多くのチームは、何千万もの小さなデータを取り込んで、非常に非効率的で非常にコストのかかるデータを取得することで、低遅延を達成しようとします。<br>
    クライアント側でのバッチ処理は役に立ちます。 
* **Kusto.Ingest クライアントに正確な非圧縮データ サイズを提供することを確認します。**<br>
    これを行わない場合、Kusto は余分なストレージ トランザクションを実行する可能性があります。
* フラグを`true`に設定した取り込`FlushImmediately`みデータの送信や、タグが設定された`ingest-by`/`drop-by`小さなチャンクの送信**は避けてください**。<br>
    これらを使用すると、Kusto サービスが取り込み中にデータを適切に集約することがなくなり、取り込み後に不要なストレージ トランザクションが発生し、COGS に影響が及ぶ可能性があります。<br>
    さらに、これらを過度に使用すると、クラスタ内のインジェストやクエリのパフォーマンスが低下する可能性があります。<br>
    