---
title: Kusto インジェストクライアントライブラリ-ベストプラクティス-Azure データエクスプローラー |Microsoft Docs
description: この記事では、Azure データエクスプローラーにおけるクライアントライブラリのベストプラクティスについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 08/16/2019
ms.openlocfilehash: 2369d352e316f1d9b49de71fb197507280598754
ms.sourcegitcommit: 1faf502280ebda268cdfbeec2e8ef3d582dfc23e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/01/2020
ms.locfileid: "82617937"
---
# <a name="kusto-ingest-client-library---best-practices"></a>Kusto インジェストクライアントライブラリ-ベストプラクティス

## <a name="choosing-the-right-ingestclient-flavor"></a>適切 IngestClient フレーバーの選択

[KustoQueuedIngestClient](kusto-ingest-client-reference.md#interface-ikustoqueuedingestclient)の使用は、推奨されるネイティブデータインジェストモードです。 理由は次のとおりです。
* エンジンのダウンタイム (デプロイ中など) で直接インジェストを行うことはできません。一方、キューに入っているインジェストモードでは、要求は Azure キューに保持され、データ管理サービスは必要に応じて再試行されます。
* データ管理サービスは、インジェスト要求でエンジンを過負荷にしないようにします。 このコントロールを上書きする (直接インジェストを使用するなど) と、取り込みとクエリの両方で、エンジンのパフォーマンスに重大な影響を与える可能性があります。
* データ管理は、作成する初期シャード (エクステント) のサイズを最適化するために、複数のインジェスト要求を集計します。
* 各インジェストに関するフィードバックを簡単に取得できます。

## <a name="tracking-ingest-operation-status"></a>取り込み操作の状態の追跡

[取り込み操作の状態の追跡](kusto-ingest-client-status.md#tracking-ingestion-status-kustoqueuedingestclient)は便利な機能です。 ただし、レポートを成功させるために有効にすることは、サービスを cripple する範囲に簡単に悪用される可能性があります。

> [!WARNING]
> 大量のデータストリームに対するインジェスト要求ごとに肯定通知を有効にすることは避けてください。これにより、基になる xStore リソースに極端な負荷がかかるためです。 余分な負荷がかかると、インジェストの待機時間が長くなり、クラスター全体の応答性が低下する可能性があります。

## <a name="optimizing-for-throughput"></a>スループットの最適化

* インジェストは、大きなまとまりで実行した場合に最適です。 最小限のリソースを消費し、最大で COGS に最適化されたデータシャードを生成し、結果として最適なデータ成果物を作成します。 一般に、Kusto インジェストライブラリを使用してデータを取り込み、エンジンに直接データを送信して、 **100 MB から 1 GB (圧縮**されていない) のデータを送信することをお勧めします。
* この上限は、取り込みプロセスで使用されるメモリの量を減らすために、エンジンを直接操作するときに重要です。 

> [!NOTE]
> `KustoQueuedIngestClient`クラスを使用すると、大量のデータブロックがより小さなチャンクに分割され、これらの小さなチャンクは、エンジンに到達する前に一定のレベルに集計されます。

* 取り込まれたデータサイズの下限は重要ですが、重要度は低くなります。 複数の小さなバッチでのデータの取り込みは、大きなバッチを使用する場合よりも若干効率が悪くなりますが、まったく問題ありません。 また`KustoQueuedIngestClient` 、クラスは、大量のデータを取り込み、それを大量のチャンクにバッチ処理してからエンジンに送信することができない場合にも問題を解決します。

## <a name="factors-impacting-ingestion-throughput"></a>インジェストスループットに影響する要因

複数の要因がインジェストのスループットに影響を与える可能性があります。 インジェストパイプラインを計画するときは、次の点を必ず評価してください。これは、COGs に大きな影響を与える可能性があります。

| 考慮すべき要素 |  Decription                                                                                               |
|--------------------------|-----------------------------------------------------------------------------------------------------------|
| データ形式              | CSV は、最も高速に取り込むことができます。 JSON では、通常、同じデータ量に対して2倍または3倍の時間がかかります。|
| テーブルの幅              | 実際に必要なデータのみを取り込むようにしてください。 テーブルの幅が広いほど、より多くの列をエンコードしてインデックスを作成する必要があるため、スループットが低下します。 インジェストマッピングを指定することで、取り込まれたを取得するフィールドを制御できます。|
| ソースデータの場所     | インジェストを高速化するために、リージョンをまたがる読み取りは避けてください。                                                       |
| クラスターに負荷をかける      | クラスターのクエリ負荷が高い場合、ingestions の完了に時間がかかり、スループットが低下します。|
| インジェストパターン        | インジェストは、最大 1 GB のバッチを使用してクラスターに提供する場合に最適です`KustoQueuedIngestClient`(を使用して処理されます)。 |

## <a name="optimizing-for-cogs"></a>COGS の最適化

Kusto クライアントライブラリを使用して Kusto にデータを取り込むと、最低でも最も信頼性の高いオプションが維持されます。 お客様にインジェスト方法をレビューし、blob トランザクションのコスト効率を大幅に向上させる Azure Storage 価格を活用することをお勧めします。

Azure データエクスプローラーインジェストのコストをより適切に制御し、毎月の請求額を減らすには、取り込まれたのデータチャンク (ファイル/blob/streams) の数を制限します。

* **取り込みのデータチャンクを優先します (圧縮**されていないデータは最大 1 gb)。 
    多くのチームは、非常に非効率的でコストのかかる大量のデータチャンクを取り込みして、短い待機時間を実現しようとしています。 クライアント側では、どの程度のバッチ処理でも役に立ちます。 
* **Kusto. インジェストクライアントに、圧縮されていない正確なデータサイズを指定している**ことを確認します。
    そうしないと、余分なストレージトランザクションが発生する可能性があります。
* フラグが`FlushImmediately`に`true`設定された、 `ingest-by` / `drop-by`またはタグが設定された小さなチャンクを送信して、取り込み用のデータを送信し**ないよう**にします。
    これらのメソッドを使用すると、インジェスト中にサービスがデータを適切に集計できなくなり、インジェストの後に不要なストレージトランザクションが発生し、その結果、COGS に影響します。
    
    また、これらを過度に使用すると、クラスターのインジェストやクエリパフォーマンスが低下する可能性があります。
    
