---
title: サンドボックス-Azure データエクスプローラー |Microsoft Docs
description: この記事では、Azure データエクスプローラーのサンドボックスについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: 6c1f836596c27f0e2901e9f7b109d96aab89cdff
ms.sourcegitcommit: bb8c61dea193fbbf9ffe37dd200fa36e428aff8c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/13/2020
ms.locfileid: "83373518"
---
# <a name="sandboxes"></a>サンドボックス

Kusto のデータエンジンサービスは、セキュリティで保護された分離を必要とする特定のフローを実行するためのサンドボックスを実行できます。
これらのフローの例は、 [Python プラグイン](../query/pythonplugin.md)または[R プラグイン](../query/rplugin.md)を使用して実行されるユーザー定義のスクリプトです。

これらのサンドボックスを実行するために、Kusto は Microsoft の[Drawbridge](https://www.microsoft.com/research/project/drawbridge/)プロジェクトの進化を使用します。 このソリューションは、マルチテナント環境でユーザー定義オブジェクトを実行するために、他の Microsoft サービスによって使用されます。

サンドボックスで実行されるフローは、分離されているだけでなく、ローカル (データに近い) でもあります。これは、リモート呼び出しに追加の待機時間が追加されないことを意味します。

## <a name="prerequisites"></a>前提条件

* データエンジンで[ディスク暗号化](../../security.md#data-encryption)を有効に**しない**でください。
  * 将来、両方の機能をサイドバイサイドで実行するためのサポートが予定されています。
* サンドボックスを実行するために必要なパッケージ (イメージ) は、各データエンジンのノードに展開され、実行するには専用の SSD 領域が必要です。
  * 推定サイズは 20 GB です。たとえば、D14_v2 VM の SSD 容量の約2.5%、L16_v1 VM の SSD 容量の0.7% です。
  * これはクラスターのデータ容量に影響するため、クラスターの[コスト](https://azure.microsoft.com/pricing/details/data-explorer)に影響を与える可能性があります。

## <a name="runtime"></a>ランタイム

* サンドボックスクエリ演算子は、実行のために1つまたは複数のサンドボックスを利用できます。
  * サンドボックスは1回の実行にのみ使用され、複数の実行間で共有されることはなく、実行が完了すると破棄されます。
  * サンドボックスは、クエリの実行にサンドボックスを初めて使用する必要があるときに、ノードで遅延初期化されます。
    * つまり、ノードでサンドボックスを使用するプラグインの最初の実行には、短いウォームアップ期間が含まれます。
  * ノードが再起動されると (たとえば、サービスのアップグレードの一部として)、そのノード上で実行されているすべてのサンドボックスが破棄されます。
* 各ノードは、事前に定義された、受信要求を実行するための準備が整ったサンドボックスを保持します。
  * サンドボックスを使用すると、新しいサンドボックスが自動的に割り当てられ、置き換えられます。
* 事前に割り当てられたサンドボックスがない場合、クエリ演算子は調整されます。
  (「[エラー](#errors)」を参照してください。新しいサンドボックスが割り当てられるまで (データノードの SKU と使用可能なリソースによっては、サンドボックスあたり最大10-15 秒かかることがあります)。

## <a name="limitations"></a>制限事項

これらの制限の一部は、各サンドボックスの種類に対して、クラスターレベルの[サンドボックスポリシー](../management/sandboxpolicy.md)を使用して制御できます。

* **ノードあたりのサンド**ボックス数:ノードごとのサンドボックスの数は制限されています。
  * 使用可能なサンドボックスがない状態になった要求は調整されます。
* **ネットワーク:** サンドボックスは、VM 上またはその外部のリソースと対話することはできません。
  * サンドボックスは、別のサンドボックスと対話することはできません。
* **CPU:** サンドボックスがホストのプロセッサを使用できる最大 CPU 速度は、(既定では) に制限されてい `50%` ます。
  * この制限に達すると、サンドボックスの CPU 使用は調整されますが、実行は続行されます。
* **メモリ:** サンドボックスがホストの RAM を消費できる最大 RAM 容量は、(既定では) に制限されてい `20GB` ます。
  * この制限に達すると、サンドボックス (およびクエリ実行エラー) が終了します。
* **ディスク:** サンドボックスには、一意のディレクトリが割り当てられています。この場合、ホストのファイルシステムにアクセスできません。
  * このフォルダーは、サンドボックスの種類 (カスタマイズできない Python または R パッケージなど) に一致するイメージまたはパッケージへのアクセスを提供します。
* **子プロセス:** サンドボックスは、子プロセスを開始できません。

> [!NOTE]
> サンドボックスのリソース使用率は、要求の一部として処理されるデータのサイズだけでなく、サンドボックスで実行されるロジックや、それによって使用されているライブラリの実装にも依存します。
> (およびプラグインの場合 `python` 、 `r` 後者はユーザー指定のスクリプトと、実行時に使用する Python または R ライブラリを意味します)。

## <a name="errors"></a>エラー

|コード                      |Message                                                                                        |考えられる理由                                                                                                    |
|--------------------------|-----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
|E_SB_QUERY_THROTTLED_ERROR|サンドボックス化されたクエリは、調整により中止されました。 バックオフが正常に完了した後に再試行する   |ターゲットノードに使用可能なサンドボックスがありません。 新しいサンドボックスは数秒で利用可能になります         |
|E_SB_QUERY_THROTTLED_ERROR|種類 ' {kind} ' のサンドボックスはまだ初期化されていません                                       |サンドボックスポリシーは最近変更されました。 新しいサンドボックス obeying 新しいポリシーが数秒で利用可能になります|
