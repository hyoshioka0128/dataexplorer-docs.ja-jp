---
title: ストレージへのデータのエクスポート - Azure データ エクスプローラー |マイクロソフトドキュメント
description: この記事では、Azure データ エクスプローラーでのストレージへのデータのエクスポートについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/12/2020
ms.openlocfilehash: 12800955d1680a280aa4772db86d8b71e44e7089
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/15/2020
ms.locfileid: "81521575"
---
# <a name="export-data-to-storage"></a>ストレージへのデータのエクスポート

クエリを実行し、最初の結果セットをストレージ[接続文字列](../../api/connection-strings/storage.md)で指定された外部ストレージに書き込みます。

**構文**

`.export`[`async`]`compressed` `to` [ ] 出力*データフォーマット*
`(`*ストレージ接続文字列*[`,` .]`)` `with` [ `(` *プロパティ名*`=`*プロパティ値*]`,``)`] `<|` *クエリ*

**引数**

* `async`: 指定した場合、コマンドが非同期モードで実行されることを示します。
  このモードでの動作の詳細については、以下を参照してください。

* `compressed`: 指定した場合、出力ストレージアーティファクトはファイルとして`.gz`圧縮されます。 寄`compressionType`木細工ファイルをスナッピーとして圧縮する場合を参照してください。 

* *OutputDataFormat*: コマンドによって書き込まれたストレージ成果物のデータ形式を示します。 サポートされる値は`csv`、 `tsv` `json`、 `parquet`、 、 、および です。

* *ストレージ接続文字列*: データの書き込み先のストレージを示す 1 つ以上のストレージ[接続文字列](../../api/connection-strings/storage.md)を指定します。 (スケーラブルな書き込みには、複数のストレージ接続文字列を指定できます)。このような接続文字列は、ストレージへの書き込み時に使用する資格情報を示す必要があります。
  たとえば、Azure BLOB ストレージに書き込むとき、資格情報はストレージ アカウント キー、または BLOB の読み取り、書き込み、およびリストのアクセス許可を持つ共有アクセス キー (SAS) にすることができます。

> [!NOTE]
> Kusto クラスター自体と同じリージョンに同じ場所にあるストレージにデータをエクスポートすることを強くお勧めします。 これには、他のリージョンの別のクラウド サービスに転送できるようにエクスポートされるデータが含まれます。 書き込みはローカルで行う必要がありますが、読み取りはリモートで行うことができます。

* *プロパティ名*/*プロパティ値*: 0 個以上のオプションのエクスポート プロパティ:

|プロパティ        |Type    |説明                                                                                                                |
|----------------|--------|---------------------------------------------------------------------------------------------------------------------------|
|`sizeLimit`     |`long`  |書き込まれる単一のストレージアーティファクトのサイズ制限 (圧縮前)。 許可される範囲は 100 MB (デフォルト) から 1GB です。|
|`includeHeaders`|`string`|出力`csv`/`tsv`の場合、列ヘッダーの生成を制御します。 (デフォルトでヘッダー`none`行が出力されない)、(すべてのストレージ`all`アーティファクトにヘッダーラインを出力する)、または`firstFile`(最初のストレージアーティファクトにのみヘッダーラインを出力する)のいずれかです。|
|`fileExtension` |`string`|ストレージアーティファクトの「拡張」部分(例えば、`.csv`または`.tsv`)を示します。 圧縮を使用する場合`.gz`は、追加されます。|
|`namePrefix`    |`string`|生成される各ストレージアーティファクト名に追加するプレフィックスを示します。 指定されていない場合は、ランダムなプレフィックスが使用されます。       |
|`encoding`      |`string`|テキストをエンコードする方法を`UTF8NoBOM``UTF8BOM`示します。 |
|`compressionType`|`string`|使用する圧縮の種類を示します。 指定できる値は `gzip` または `snappy` です。 既定値は `gzip` です。 `snappy`フォーマットに使用できます (オプション)。 `parquet` |
|`distribution`   |`string`  |配布ヒント`single`( `per_node` `per_shard`, , ) 値が 等`single`しい場合、単一のスレッドがストレージに書き込みます。 それ以外の場合、export はクエリを実行しているすべてのノードから並列で書き込みます。 [プラグイン演算子の評価](../../query/evaluateoperator.md)を参照してください。 既定値は `per_shard` です。
|`distributed`   |`bool`  |分散エクスポートを無効/有効にします。 false に設定すると、`single`配布ヒントと同じになります。 既定値は true です。
|`persistDetails`|`bool`  |コマンドが結果を保持する必要があることを示します`async`(フラグを参照)。 デフォルトは非同期`true`実行ですが、呼び出し元が結果を必要としない場合はオフにできます)。 デフォルトは同期`false`実行ですが、それらでもオンにできます。 |
|`parquetRowGroupSize`|`int`  |データ形式が寄木細工の場合にのみ関連します。 エクスポートされたファイルの行グループサイズを制御します。 デフォルトの行グループサイズは 100000 レコードです。|

**結果**

コマンドは、生成されたストレージ成果物を説明する表を戻します。
各レコードは、1 つの成果物を記述し、成果物へのストレージ パスと、それが保持するデータ レコードの数を含みます。

|Path|数字の記録|
|---|---|
|http://storage1.blob.core.windows.net/containerName/export_1_d08afcae2f044c1092b279412dcb571b.csv|10|
|http://storage1.blob.core.windows.net/containerName/export_2_454c0f1359e24795b6529da8a0101330.csv|15|

**非同期モード**

フラグが`async`指定されている場合、コマンドは非同期モードで実行されます。
このモードでは、コマンドは操作 ID を使用してすぐに戻り、データのエクスポートは完了するまでバックグラウンドで続行されます。 コマンドによって返される操作 ID は、次のコマンドを使用して、その進行状況と最終的に結果を追跡するために使用できます。

* [.show 操作](../operations.md#show-operations): 進捗状況を追跡します。
* [.show 操作の詳細](../operations.md#show-operation-details): 完了結果を取得します。

たとえば、正常に完了した後、次の方法で結果を取得できます。

```kusto
.show operation f008dc1e-2710-47d8-8d34-0d562f5f8615 details
```

**使用例** 

この例では、Kusto はクエリを実行し、クエリによって生成された最初のレコードセットを 1 つ以上の圧縮 CSV BLOB にエクスポートします。
列名ラベルは、各 BLOB の最初の行として追加されます。

```kusto 
.export
  async compressed
  to csv (
    h@"https://storage1.blob.core.windows.net/containerName;secretKey",
    h@"https://storage1.blob.core.windows.net/containerName2;secretKey"
  ) with (
    sizeLimit=100000,
    namePrefix=export,
    includeHeaders=all,
    encoding =UTF8NoBOM
  )
  <| myLogs | where id == "moshe" | limit 10000
```

**既知の問題**

*エクスポート・コマンド中のストレージ・エラー*

デフォルトでは、エクスポート・コマンドは、エクスポートするデータを含むすべての[エクステント](../extents-overview.md)がストレージに同時に書き込みできるように配布されます。 大規模なエクスポートでは、このようなエクステントの数が多い場合、ストレージの負荷が高く、ストレージの調整や一時的なストレージ エラーが発生する可能性があります。 このような場合は、エクスポート コマンドに提供されるストレージ アカウントの数を増やしてみる (アカウント間で負荷が分散されます) とディストリビューション ヒントを設定して同時実行を減らす (`per_node`コマンドのプロパティを参照してください) お勧めします。 配布を完全に無効にすることも可能ですが、これはコマンドのパフォーマンスに大きな影響を与える可能性があります。
 