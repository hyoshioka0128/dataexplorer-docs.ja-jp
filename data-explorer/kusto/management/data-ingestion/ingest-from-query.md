---
title: クエリからの取り込み (.set、.append、.set または append、.set または replace) - Azure データ エクスプローラー |マイクロソフトドキュメント
description: この記事では、Azure データ エクスプローラーでクエリ (.set、.append、.set または append、.set または replace) からの取り込みについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: fb0bbb06bb8d28dd3951a7faedf55b0d84155301
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/15/2020
ms.locfileid: "81521456"
---
# <a name="ingest-from-query-set-append-set-or-append-set-or-replace"></a>クエリからの取り込み (.set、.append、.set または append、.set または replace)

これらのコマンドは、クエリまたは制御コマンドを実行し、クエリの結果をテーブルに取り込みます。 これらのコマンドの違いは、既存のテーブルや存在しないテーブルとデータをどのように扱うかです。

|command          |テーブルが存在する場合                     |テーブルが存在しない場合                    |
|-----------------|------------------------------------|------------------------------------------|
|`.set`           |コマンドが失敗します。                  |テーブルが作成され、データが取り込まれます。|
|`.append`        |データがテーブルに追加されます。      |コマンドが失敗します。                        |
|`.set-or-append` |データがテーブルに追加されます。      |テーブルが作成され、データが取り込まれます。|
|`.set-or-replace`|データは、テーブル内のデータを置き換えます。|テーブルが作成され、データが取り込まれます。|

**構文**

`.set`[`async`]*テーブル名*`with``(`[*プロパティ名*`=`*プロパティ値*] [.]`,``)`] `<|` *クエリまたはコマンド*

`.append`[`async`]*テーブル名*`with``(`[*プロパティ名*`=`*プロパティ値*]`,``])`] `<|` *クエリまたはコマンド*

`.set-or-append`[`async`]*テーブル名*`with``(`[*プロパティ名*`=`*プロパティ値*] [.]`,``)`] `<|` *クエリまたはコマンド*

`.set-or-replace`[`async`]*テーブル名*`with``(`[*プロパティ名*`=`*プロパティ値*] [.]`,``)`] `<|` *クエリまたはコマンド*

**引数**

* `async`: 指定すると、コマンドはすぐに戻り、バックグラウンドでインジェクションを続行します。 コマンドの結果には、取り込`OperationId`み完了ステータスと結果を`.show operation`取得するためにコマンドとともに使用できる値が含まれます。
* *テーブル名*: データを取り込むテーブルの名前。
  テーブル名は、常にコンテキスト内のデータベースに対して相対的です。
* *プロパティ名*、*プロパティ値*: 取り込み処理に影響を与える任意の数の取り込みプロパティ。

 サポートされているインジェクション プロパティ:

|プロパティ        |説明|
|----------------|-----------------------------------------------------------------------------------------------------------------------------|
|`creationTime`   | 取り込まれたデータエクステントの作成時に使用する日時値 (ISO8601 ストリングとしてフォーマットされます)。 指定されていない場合は、現在の値 (now()) が使用されます。|
|`extend_schema`  | 指定した場合に、テーブルのスキーマを拡張するようにコマンドに指示するブール値です (既定値は false です)。 このオプションは、.append .set-or-append コマンドおよび set-or-replace コマンドにのみ適用されます。 許可されるスキーマ拡張のみ、テーブルの最後に列が追加されます。|
|`recreate_schema`  | 指定した場合、コマンドがテーブルのスキーマを再作成できるかどうかを示すブール値です (既定値は false)。 このオプションは、set-or-replace コマンドにのみ適用されます。 このオプションは、両方が設定されている場合は、extend_schemaプロパティよりも優先されます。|
|`folder`         | テーブルに割り当てるフォルダ。 テーブルが既に存在する場合、このプロパティはテーブルのフォルダをオーバーライドします。|
|`ingestIfNotExists`   | 指定した場合に、テーブルに同じ値を持つ INGESTBY: タグが既に付いている場合に、取り込みが成功するのを防ぐ文字列値。|
|`policy_ingestiontime`   | ブール値。指定されている場合、このコマンドで作成されるテーブルで [IngestionTime ポリシー](../../management/ingestiontime-policy.md)を有効にするかどうかを記述します  既定値は true です。|
|`tags`   | インジェスト中に実行する検証を示す JSON 文字列。|
|`docstring`   | テーブルを表す文字列。|

  さらに、コマンド自体の動作を制御するプロパティがあります。

|プロパティ        |Type    |説明|
|----------------|--------|-----------------------------------------------------------------------------------------------------------------------------|
|`distributed`   |`bool`  |クエリを実行しているすべてのノードから、コマンドが並列で取得することを示します。 (デフォルトは`false`.) 以下の備考を参照してください。|

* *QueryOrCommand*: クエリまたはコントロール コマンドのテキストで、その結果を取得するデータとして使用します。

> [!NOTE]
> 制御`.show`コマンドのみがサポートされます。

**解説**

* `.set-or-replace`テーブルのデータが存在する場合は置換 (既存のデータシャードを削除) するか、または存在しない場合はターゲットテーブルを作成します。
  テーブル スキーマは、または`extend_schema``recreate_schema`取り込みプロパティのいずれかが に`true`設定されていない限り、保持されます。 スキーマが変更された場合、これは、自身のトランザクションで実際のデータ取り込み前に発生するため、データの取り込みが失敗しても、スキーマが変更されなかったわけではありません。
* `.set-or-append`を`.append`使用すると、インジェスト`extend_schema`プロパティが`true`に設定されていない限り、スキーマは保持されます。 スキーマが変更された場合、これは、自身のトランザクションで実際のデータ取り込み前に発生するため、データの取り込みが失敗しても、スキーマが変更されなかったわけではありません。
* インジェスト操作ごとにインジェストデータを 1 GB 未満に制限**することを強くお勧めします**。 必要に応じて、複数の取り込みコマンドを使用できます。
* データ取り込みは、クエリの実行を含め、クラスター上の同時アクティビティーに影響を与える可能性があるリソースを大量に消費する操作です。 このようなコマンドを同時に「多すぎる」コマンドを同時に実行しないようにします。
* 結果セットスキーマをターゲット表のスキーマと一致させる場合、比較は列の型に基づいて行われます。 列名の一致はないので、クエリ結果スキーマの列がテーブルと同じ順序であることを確認してください。
* フラグを`distributed`に`true`設定すると、クエリによって生成されるデータの量が多い (1 GB を超えるデータ)**場合、** およびクエリがシリアル化を必要としない場合に便利です (複数のノードが並列で出力を生成できるようにします)。
  クエリ結果が小さい場合は、このフラグを使用することは推奨されません。

**使用例** 

現在のデータベースに "LogsTable" と同じスキーマを持ち、過去 1 時間のすべてのエラー レコードを保持する新しいテーブル "RecentErrors" を作成します。

```kusto
.set RecentErrors <|
   LogsTable
   | where Level == "Error" and Timestamp > now() - time(1h)
```

「MyExtents」という名前の既存のテーブルに基づいて、1 つの列 (「ExtentId」) を持ち、30 日以上前に作成されたデータベース内のすべてのエクステントのエクステント ID を保持する、現在のデータベースに"OldExtents"という名前の新しいテーブルを作成します。

```kusto
.set async OldExtents <| 
   MyExtents 
   | where CreatedOn < now() - time(30d) 
   | project ExtentId     
```

1 つの列 (「ExtentId」) を持ち、30 日以上前に作成されたデータベース内のすべてのエクステントのエクステント ID を保持する現在のデータベースの既存のテーブル "OldExtents" にデータを追加し、"MyExtents" という名前の既存のテーブルに基づいて新しいエクステントにタグ`tagA`と をタグ付け`tagB`します。

```kusto
.append OldExtents with(tags='["TagA","TagB"]') <| 
   MyExtents 
   | where CreatedOn < now() - time(30d) 
   | project ExtentId     
```
 
現在のデータベースの "OldExtents" テーブルにデータを追加する (または、まだ存在しない場合はテーブルを作成する) と、`ingest-by:myTag`新しいエクステントにタグを付けます。 この操作は、"MyExtents" という名前の既存のテーブル`ingest-by:myTag`に基づいて、テーブルに タグ付けされたエクステントがまだ含まれていない場合に限られます。

```kusto
.set-or-append async OldExtents with(tags='["ingest-by:myTag"]', ingestIfNotExists='["myTag"]') <| 
   MyExtents 
   | where CreatedOn < now() - time(30d) 
   | project ExtentId     
```

現在`ingest-by:myTag`のデータベースの "OldExtents" テーブルのデータを置き換えます (または、まだ存在しない場合はテーブルを作成します)。

```kusto
.set-or-replace async OldExtents with(tags='["ingest-by:myTag"]', ingestIfNotExists='["myTag"]') <| 
   MyExtents 
   | where CreatedOn < now() - time(30d) 
   | project ExtentId     
```

作成されたエクステント作成時刻を過去の特定の日時に設定しながら、現在のデータベースの 「OldExtents」テーブルにデータを追加します。

```kusto
.append async OldExtents with(creationTime='2017-02-13T11:09:36.7992775Z') <| 
   MyExtents 
   | where CreatedOn < now() - time(30d) 
   | project ExtentId     
```

**出力を返す**
 
コマンド`.append`の結果として作成されたエクステントに関する情報`.set`を返します。

**出力例**

|エクステントID |オリジナルサイズ |エクステントサイズ |圧縮サイズ |IndexSize |RowCount | 
|--|--|--|--|--|--|
|23a05ed6-376d-4119-b1fc-6493bcb05563 |1291 |5882 |1568 |4314 |10 |