---
title: データ インジェスト - Azure Data Explorer | Microsoft Docs
description: この記事では、Azure Data Explorer のデータ インジェストについて説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 03/30/2020
ms.openlocfilehash: f0fb68395ec5ed647e1f28cc1c93d46083d405c6
ms.sourcegitcommit: bb8c61dea193fbbf9ffe37dd200fa36e428aff8c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/13/2020
ms.locfileid: "83373441"
---
# <a name="data-ingestion"></a>データ インジェスト

データをテーブルに追加してクエリに使用できるようにするプロセスです。
事前にテーブルの存在に応じて、このプロセスには[データベース管理者、データベース取り込み者、データベース ユーザー、またはテーブル管理者のアクセス許可](../access-control/role-based-authorization.md)が必要です。

データ インジェスト プロセスは、次のいくつかの手順で構成されています。

1. データ ソースからデータを取得する。
1. データを構文解析して検証する。
1. データのスキーマをターゲット Kusto テーブルのスキーマと一致させる、またはターゲット テーブルがまだ存在しない場合は作成する。
1. データを列内に整理する。
1. データにインデックスを付ける。
1. データをエンコードおよび圧縮する。
1. 結果として得られる Kusto ストレージの成果物をストレージに保持する。
1. 関連するすべての更新ポリシー (ある場合) を実行する。
1. データ インジェストを "コミット" して、クエリに使用できるようにする。

> [!NOTE]
> 上記の手順の一部は、特定のシナリオによってはスキップされる場合があります。
> たとえば、ストリーミング インジェスト エンドポイントを介して取り込まれたデータでは、手順 4、5、6、および 9 がスキップされます。 これらはデータが "クリーンアップ" されるときにバックグラウンドで実行されます。
> もう 1 つの例として、データ ソースが同じクラスターに対して Kusto クエリを実行した結果である場合は、データを解析して検証する必要はありません。

> [!WARNING]
> Kusto のテーブルに取り込まれたデータは、テーブルの有効な**保持ポリシー**の対象となります。
> テーブルに明示的に設定しない限り、有効な保持ポリシーはデータベースの保持ポリシーから取得されます。 そのため、Kusto にデータを取り込むときは、データベースの保持ポリシーがご自分のニーズに適していることを確認してください。 適していない場合は、テーブル レベルで明示的にオーバーライドします。 そうしないと、データベースの保持ポリシーによってデータが "サイレントに" 削除されてしまう可能性があります。 詳しくは、「[Retention policy](https://kusto.azurewebsites.net/docs/concepts/retentionpolicy.html)」(アイテム保持ポリシー) をご覧ください。

データ インジェストのプロパティについては、「[データ インジェストのプロパティ](../../../ingestion-properties.md)」を参照してください。
データ インジェストでサポートされている形式の一覧については、[データ形式](../../../ingestion-supported-formats.md)に関する記事を参照してください。



## <a name="ingestion-methods"></a>インジェストの方法

データを取り込む方法はいくつかあり、それぞれに独自の特性があります。

1. **インライン インジェスト (プッシュ)** : 取り込まれるデータをコマンド テキスト自体の一部として、制御コマンド ([.ingest inline](./ingest-inline.md)) がエンジンに送信されます。
   この方法は、主にアドホック テストを対象としており、運用目的では使用しないでください。
1. **クエリからの取り込み**:クエリまたはコマンドの結果としてデータを間接的に指定し、制御コマンド ([.set、.append、.set-or-append、または .set-or-replace](./ingest-from-query.md)) がエンジンに送信されます。
   この方法は、未加工のデータ テーブルからレポート テーブルを生成する場合や、さらに分析するために小さな一時テーブルを作成する場合に便利です。
1. **ストレージからの取り込み (プル)** :エンジンによってアクセス可能であり、コマンドで指定された外部ストレージ (Azure Blob Storage など) にデータを格納して、制御コマンド ([.ingest into](./ingest-from-storage.md)) がエンジンに送信されます。
   この方法を使用すると、効率的なデータの一括インジェストが可能ですが、同時インジェストによってクラスターに過大な負荷を掛けないようにするために、インジェストを実行するクライアントに若干の負荷がかかります (そうしないと、データ インジェストによってすべてのクラスター リソースが消費されて、クエリのパフォーマンスが低下するリスクがあります)。
1. **キューによるインジェスト**:データは外部ストレージにアップロードされます (たとえば、Azure Blob Storage)。 通知がキュー (Azure キューやイベント ハブなど) に送信されます。
   この方法は、非常に高い可用性を備えており、クライアント自体で容量管理を実行する必要はなく、一括追加が処理されるため、実稼働環境で最も使用されます。 これは、"ネイティブ インジェスト" と呼ばれることもあります。


|Method             |Latency                 |Production|一括|可用性|同期|
|-------------------|------------------------|----------|----|------------|-------------|
|インライン インジェスト   |秒 + インジェスト時間   |いいえ        |いいえ  |Kusto エンジン|同期  |
|クエリからの取り込み  |クエリ時間 + インジェスト時間|はい       |はい |Kusto エンジン|同期  |
|ストレージからの取り込み|秒 + インジェスト時間   |はい       |はい |Kusto エンジン|両方         |
|キューによるインジェスト   |分                 |はい       |はい |ストレージ     |非同期 |

## <a name="validation-policy-during-ingestion"></a>インジェスト中の検証ポリシー

ストレージから取り込む場合、ソース データは解析の一部として検証されます。
検証ポリシーは、解析エラーに対処する方法を示します。 次の 2 つのプロパティで構成されます。

* `ValidationOptions`:ここで、`0` は、検証を実行する必要がないことを示し、`1` は、すべてのレコードが同じ数のフィールドを持っていることを検証し (CSV ファイルおよび同様のファイルに便利)、`2` は、二重引用符で囲まれていないフィールドを無視することを示します。

* `ValidationImplications`: `0` は、検証エラーによりインジェスト全体が失敗することを示し、`1` は、検証エラーを無視すべきであることを示します。