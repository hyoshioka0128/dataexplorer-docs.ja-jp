---
title: キャッシュ ポリシー (ホット キャッシュとコールド キャッシュ) - Azure データ エクスプローラー |マイクロソフトドキュメント
description: この記事では、Azure データ エクスプローラーでキャッシュ ポリシー (ホット キャッシュとコールド キャッシュ) について説明します。
services: data-explorer
author: orspod
ms.author: orspodek
ms.reviewer: rkarlin
ms.service: data-explorer
ms.topic: reference
ms.date: 02/19/2020
ms.openlocfilehash: 591763ac5d94a8361a4b78c1b199bb05299cc004
ms.sourcegitcommit: 47a002b7032a05ef67c4e5e12de7720062645e9e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/15/2020
ms.locfileid: "81522136"
---
# <a name="cache-policy-hot-and-cold-cache"></a>キャッシュ ポリシー (ホット キャッシュとコールド キャッシュ)

Azure データ エクスプローラーでは、取得したデータは、実際の処理 (Azure コンピューティングなど) ノードから離れた信頼性の高いストレージ (最も一般的には Azure Blob Storage) に格納されます。 そのデータに対するクエリを高速化するために、Azure Data Explorer は、このデータ (またはその一部) を処理ノード、SSD、RAM にキャッシュします。 Azure Data Explorer には、キャッシュするデータ オブジェクトをインテリジェントに決定するための高度なキャッシュ メカニズムが含まれています。 キャッシュを使用すると、Azure Data Explorer は、より重要なデータを優先できるように、使用するデータアーティファクト (列インデックスや列データシャードなど) を記述できます。

すべての取り込みデータがキャッシュされると、クエリのパフォーマンスが最も高くなりますが、ローカル SSD ストレージでデータを "暖かく" 保つコストを正当化できないデータがあります。
たとえば、多くのチームは、アクセスが少ない古いログ レコードの重要性が低いと考えています。
このデータを常に暖かく保つために支払うよりも、このデータをクエリする際のパフォーマンスが低下することを好みます。

Azure Data Explorer キャッシュは、顧客が 2 つのデータ キャッシュ ポリシー (**ホット データ キャッシュ**とコールド データ**キャッシュ**) を区別するために使用できる、詳細なキャッシュ**ポリシー**を提供します。 Azure Data Explorer キャッシュは、ローカルの SSD (または RAM) 内のホット データ キャッシュに含まれるすべてのデータを、定義されたホット データ キャッシュのサイズまで保持しようとします。 残りのローカル SSD スペースは、ホットとして分類されていないデータを保持するために使用されます。 この設計の有用な意味の 1 つは、信頼性のあるストレージから大量のコールド データを読み込むクエリでは、ホット データ キャッシュからデータが削除されないことです。 したがって、ホット データ キャッシュ内のデータに関連するクエリに大きな影響はありません。

ホット キャッシュ ポリシーを設定する主な意味は次のとおりです。
* **コスト**信頼性の高いストレージのコストは、ローカルの SSD よりも大幅に低くなる可能性があります (たとえば、Azure では現在約 45 倍安くなっています)。
* **パフォーマンス**ローカル SSD 内にあるデータは、より高速に照会できます。 これは、範囲クエリ、つまり大量のデータをスキャンするクエリに特に当てはまります。  

[制御コマンド](cache-policy.md)を使用すると、管理者はキャッシュ・ポリシーを管理できます。

## <a name="how-the-cache-policy-gets-applied"></a>キャッシュ ポリシーの適用方法

データが Azure データ エクスプローラーに取り込まれると、システムはインジェストが実行された日時と範囲が作成された日時を追跡します。 エクステントの取り込み日時の値 (または、エクステントが複数の既存のエクステントから構築された場合の最大値) は、キャッシュ ポリシーの評価に使用されます。

既定では、有効なポリシーは`null`、 すべてのデータが**ホット**と見なされます。
テーブルレベル以外`null`のポリシーは、データベースレベルのポリシーを上書きします。

> [!Note] 
> 取り込み日時の値は、インジェスプロパティ`creationTime`を使用して指定できます。 

## <a name="scoping-queries-to-hot-cache"></a>クエリをホット キャッシュにスコープする

Kusto は、ホット キャッシュ データのみにスコープダウンされたクエリをサポートします。 これにはいくつかの方法があります。

- クエリの [可能な`query_datascope`値] `default`、、および`all``hotcache`に呼び出されるクライアント要求プロパティを追加します。
- クエリ`set`テキストでステートメントを使用します`set query_datascope='...'`: 、可能な値は、クライアント要求のプロパティの場合と同じです。
- クエリ本文`datascope=...`のテーブル参照の直後にテキストを追加します。 設定可能な値は `all` および `hotcache` です。

この`default`値は、クラスターの既定の設定を使用していることを示し、クエリがすべてのデータを対象とすることを決定します。



異なるメソッド間に不一致がある場合:`set`クライアント要求プロパティよりも優先され、テーブル参照の値を指定する方が両方よりも優先されます。

たとえば、次のクエリでは、すべてのテーブル参照で hotcache データのみが使用されますが、そのスコープが`T`すべてのデータに対する 2 番目の参照は除きます。

```kusto
set query_datascope="hotcache";
T | union U | join (T datascope=all | where Timestamp < ago(365d) on X
```

## <a name="cache-policy-vs-retention-policy"></a>キャッシュ ポリシーと保持ポリシー

キャッシュ ポリシーは[、保持ポリシー](./retentionpolicy.md)とは無関係です。 
- キャッシュ ポリシーでは、重要なデータに対するクエリが、重要度の低いデータに対するクエリの影響に対して高速かつ耐性を持たるように、リソースの優先順位付け方法を定義します。 
- 保持ポリシーは、テーブル/データベース内の照会可能データの範囲を定義`SoftDeletePeriod`します (具体的には)。

予想されるクエリ パターンに基づいてコストとパフォーマンスの最適なバランスを実現するように、このポリシーを構成することをお勧めします。

例:
* `SoftDeletePeriod`= 56d
* `hot cache policy`= 28d

この例では、過去 28 日間のデータはクラスター SSD 上にあり、**追加**の 28 日間は Azure BLOB ストレージに格納されます。 56 日間のデータ全体に対してクエリを実行できます。 

## <a name="cache-policy-does-not-make-kusto-a-cold-storage-technology"></a>キャッシュ ポリシーでは Kusto がコールド ストレージ テクノロジになっていません

Azure データ エクスプローラーは、クラスターの総 RAM に適合する中間結果セットを使用して、アドホック クエリを実行するように設計されています。 map-reduce のような大規模なジョブでは、中間結果を永続的なストレージ (SSD など) に格納する場合は、連続エクスポート機能を使用します。 これにより、HDInsight や Azure データブリックなどのサービスを使用して、実行時間の長いバッチ クエリを実行できます。